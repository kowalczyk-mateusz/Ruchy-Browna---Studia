// https://github.com/vasturiano/d3-force-bounce Version 0.4.4. Copyright 2017 Vasco Asturiano.
!function(t,n){"object"==typeof exports&&"undefined"!=typeof module?n(exports):"function"==typeof define&&define.amd?define(["exports"],n):n(t.d3=t.d3||{})}(this,function(t){"use strict";function n(t,n,i,r){if(isNaN(n)||isNaN(i))return t;var e,o,s,h,a,u,f,l,c,x=t._root,y={data:r},_=t._x0,d=t._y0,v=t._x1,p=t._y1;if(!x)return t._root=y,t;for(;x.length;)if((u=n>=(o=(_+v)/2))?_=o:v=o,(f=i>=(s=(d+p)/2))?d=s:p=s,e=x,!(x=x[l=f<<1|u]))return e[l]=y,t;if(h=+t._x.call(null,x.data),a=+t._y.call(null,x.data),n===h&&i===a)return y.next=x,e?e[l]=y:t._root=y,t;do e=e?e[l]=new Array(4):t._root=new Array(4),(u=n>=(o=(_+v)/2))?_=o:v=o,(f=i>=(s=(d+p)/2))?d=s:p=s;while((l=f<<1|u)==(c=(a>=s)<<1|h>=o))return e[c]=x,e[l]=y,t}function i(t){var i,r,e,o,s=t.length,h=new Array(s),a=new Array(s),u=1/0,f=1/0,l=-(1/0),c=-(1/0);for(r=0;r<s;++r)isNaN(e=+this._x.call(null,i=t[r]))||isNaN(o=+this._y.call(null,i))||(h[r]=e,a[r]=o,e<u&&(u=e),e>l&&(l=e),o<f&&(f=o),o>c&&(c=o));for(l<u&&(u=this._x0,l=this._x1),c<f&&(f=this._y0,c=this._y1),this.cover(u,f).cover(l,c),r=0;r<s;++r)n(this,h[r],a[r],t[r]);return this}function r(t){for(var n=0,i=t.length;n<i;++n)this.remove(t[n]);return this}function e(t){return t[0]}function o(t){return t[1]}function s(t,n,i){var r=new h(null==n?e:n,null==i?o:i,NaN,NaN,NaN,NaN);return null==t?r:r.addAll(t)}function h(t,n,i,r,e,o){this._x=t,this._y=n,this._x0=i,this._y0=r,this._x1=e,this._y1=o,this._root=void 0}function a(t){for(var n={data:t.data},i=n;t=t.next;)i=i.next={data:t.data};return n}var u=function(t){var i=+this._x.call(null,t),r=+this._y.call(null,t);return n(this.cover(i,r),i,r,t)},f=function(t,n){if(isNaN(t=+t)||isNaN(n=+n))return this;var i=this._x0,r=this._y0,e=this._x1,o=this._y1;if(isNaN(i))e=(i=Math.floor(t))+1,o=(r=Math.floor(n))+1;else{if(!(i>t||t>e||r>n||n>o))return this;var s,h,a=e-i,u=this._root;switch(h=(n<(r+o)/2)<<1|t<(i+e)/2){case 0:do s=new Array(4),s[h]=u,u=s;while(a*=2,e=i+a,o=r+a,t>e||n>o)break;case 1:do s=new Array(4),s[h]=u,u=s;while(a*=2,i=e-a,o=r+a,i>t||n>o)break;case 2:do s=new Array(4),s[h]=u,u=s;while(a*=2,e=i+a,r=o-a,t>e||r>n)break;case 3:do s=new Array(4),s[h]=u,u=s;while(a*=2,i=e-a,r=o-a,i>t||r>n)}this._root&&this._root.length&&(this._root=u)}return this._x0=i,this._y0=r,this._x1=e,this._y1=o,this},l=function(){var t=[];return this.visit(function(n){if(!n.length)do t.push(n.data);while(n=n.next)}),t},c=function(t){return arguments.length?this.cover(+t[0][0],+t[0][1]).cover(+t[1][0],+t[1][1]):isNaN(this._x0)?void 0:[[this._x0,this._y0],[this._x1,this._y1]]},x=function(t,n,i,r,e){this.node=t,this.x0=n,this.y0=i,this.x1=r,this.y1=e},y=function(t,n,i){var r,e,o,s,h,a,u,f=this._x0,l=this._y0,c=this._x1,y=this._y1,_=[],d=this._root;for(d&&_.push(new x(d,f,l,c,y)),null==i?i=1/0:(f=t-i,l=n-i,c=t+i,y=n+i,i*=i);a=_.pop();)if(!(!(d=a.node)||(e=a.x0)>c||(o=a.y0)>y||(s=a.x1)<f||(h=a.y1)<l))if(d.length){var v=(e+s)/2,p=(o+h)/2;_.push(new x(d[3],v,p,s,h),new x(d[2],e,p,v,h),new x(d[1],v,o,s,p),new x(d[0],e,o,v,p)),(u=(n>=p)<<1|t>=v)&&(a=_[_.length-1],_[_.length-1]=_[_.length-1-u],_[_.length-1-u]=a)}else{var w=t-+this._x.call(null,d.data),g=n-+this._y.call(null,d.data),N=w*w+g*g;if(N<i){var A=Math.sqrt(i=N);f=t-A,l=n-A,c=t+A,y=n+A,r=d.data}}return r},_=function(t){if(isNaN(o=+this._x.call(null,t))||isNaN(s=+this._y.call(null,t)))return this;var n,i,r,e,o,s,h,a,u,f,l,c,x=this._root,y=this._x0,_=this._y0,d=this._x1,v=this._y1;if(!x)return this;if(x.length)for(;;){if((u=o>=(h=(y+d)/2))?y=h:d=h,(f=s>=(a=(_+v)/2))?_=a:v=a,n=x,!(x=x[l=f<<1|u]))return this;if(!x.length)break;(n[l+1&3]||n[l+2&3]||n[l+3&3])&&(i=n,c=l)}for(;x.data!==t;)if(r=x,!(x=x.next))return this;return(e=x.next)&&delete x.next,r?(e?r.next=e:delete r.next,this):n?(e?n[l]=e:delete n[l],(x=n[0]||n[1]||n[2]||n[3])&&x===(n[3]||n[2]||n[1]||n[0])&&!x.length&&(i?i[c]=x:this._root=x),this):(this._root=e,this)},d=function(){return this._root},v=function(){var t=0;return this.visit(function(n){if(!n.length)do++t;while(n=n.next)}),t},p=function(t){var n,i,r,e,o,s,h=[],a=this._root;for(a&&h.push(new x(a,this._x0,this._y0,this._x1,this._y1));n=h.pop();)if(!t(a=n.node,r=n.x0,e=n.y0,o=n.x1,s=n.y1)&&a.length){var u=(r+o)/2,f=(e+s)/2;(i=a[3])&&h.push(new x(i,u,f,o,s)),(i=a[2])&&h.push(new x(i,r,f,u,s)),(i=a[1])&&h.push(new x(i,u,e,o,f)),(i=a[0])&&h.push(new x(i,r,e,u,f))}return this},w=function(t){var n,i=[],r=[];for(this._root&&i.push(new x(this._root,this._x0,this._y0,this._x1,this._y1));n=i.pop();){var e=n.node;if(e.length){var o,s=n.x0,h=n.y0,a=n.x1,u=n.y1,f=(s+a)/2,l=(h+u)/2;(o=e[0])&&i.push(new x(o,s,h,f,l)),(o=e[1])&&i.push(new x(o,f,h,a,l)),(o=e[2])&&i.push(new x(o,s,l,f,u)),(o=e[3])&&i.push(new x(o,f,l,a,u))}r.push(n)}for(;n=r.pop();)t(n.node,n.x0,n.y0,n.x1,n.y1);return this},g=function(t){return arguments.length?(this._x=t,this):this._x},N=function(t){return arguments.length?(this._y=t,this):this._y},A=s.prototype=h.prototype;A.copy=function(){var t,n,i=new h(this._x,this._y,this._x0,this._y0,this._x1,this._y1),r=this._root;if(!r)return i;if(!r.length)return i._root=a(r),i;for(t=[{source:r,target:i._root=new Array(4)}];r=t.pop();)for(var e=0;e<4;++e)(n=r.source[e])&&(n.length?t.push({source:n,target:r.target[e]=new Array(4)}):r.target[e]=a(n));return i},A.add=u,A.addAll=i,A.cover=f,A.data=l,A.extent=c,A.find=y,A.remove=_,A.removeAll=r,A.root=d,A.size=v,A.visit=p,A.visitAfter=w,A.x=g,A.y=N;var M=function(t){return function(){return t}},m=function(){function t(){function t(t,n,i,r,e=1){return{a:(e*n*(r-i)+t*i+n*r)/(t+n),b:(e*t*(i-r)+t*i+n*r)/(t+n)}}function h({x:x,y:y},t){const n=a(x,y);return u(n.d,n.a+t)}function a(t,n){return t=t||0,{d:Math.sqrt(t*t+n*n),a:0===t&&0===n?0:Math.atan(n/t)+(t<0?Math.PI:0)}}function u(t,n){return{x:t*Math.cos(n),y:t*Math.sin(n)}}const f=s(n,t=>t.x,t=>t.y).visitAfter(t=>{if(t.data)return t.r=e(t.data);for(let n=t.r=0;n<4;++n)t[n]&&t[n].r>t.r&&(t.r=t[n].r)});n.forEach(n=>{const s=e(n);f.visit((e,f,l,c,x)=>{const y=e.data,_=e.r,d=s+_;if(!y)return f>n.x+d||c<n.x-d||l>n.y+d||x<n.y-d;if(y.index>n.index){if(n.x===y.x&&n.y===y.y){const t=u(1e-6,2*Math.random()*Math.PI);y.x+=t.x,y.y+=t.y}const e=a(y.x-n.x,y.y-n.y),f=Math.max(0,d-e.d);if(!f)return;const l=h({x:n.vx,y:n.vy},-e.a),c=h({x:y.vx,y:y.vy},-e.a);({a:l.x,b:c.x}=t(o(n),o(y),l.x,c.x,r)),({x:n.vx,y:n.vy}=h(l,e.a)),({x:y.vx,y:y.vy}=h(c,e.a));const x=u(f,e.a),v=s/(s+_);n.x-=x.x*(1-v),n.y-=x.y*(1-v),y.x+=x.x*v,y.y+=x.y*v,i&&i(n,y)}})})}let n,i,r=1,e=t=>1,o=t=>Math.pow(e(t),2);return t.initialize=function(t){n=t},t.elasticity=function(n){return arguments.length?(r=n,t):r},t.radius=function(n){return arguments.length?(e="function"==typeof n?n:M(+n),t):e},t.mass=function(n){return arguments.length?(o="function"==typeof n?n:M(+n),t):o},t.onImpact=function(n){return arguments.length?(i=n,t):i},t};t.forceBounce=m,Object.defineProperty(t,"__esModule",{value:!0})});